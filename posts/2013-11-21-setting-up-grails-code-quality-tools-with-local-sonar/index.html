<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Setting up Grails code quality tools with local Sonar</title><!-- facebook open graph tags --><meta property=og:type content=article><meta property=og:site_name content="Ryan Brooks' blog"><meta property=og:url content="https://www.ryanbrooks.co.uk/posts/2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar/"><meta property=og:title content="Setting up Grails code quality tools with local Sonar"><meta property=og:description content=""><!-- twitter card tags additive with the og: tags --><meta name=twitter:card content=summary><meta name=twitter:site content=@spikeheap><meta name=twitter:url value="https://www.ryanbrooks.co.uk/posts/2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar/"><meta name=twitter:title value="Setting up Grails code quality tools with local Sonar"><meta name=twitter:description value=""><meta name=twitter:label1 value="Reading time"><meta name=twitter:data1 value="üïí 4 minutes"><meta name=viewport content="width=device-width, initial-scale=1"><link rel=alternate type=application/rss+xml title="Ryan Brooks' blog" href=https://www.ryanbrooks.co.uk/feed.xml><link rel=stylesheet href=/css/style.4ebd.css><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-43110335-1');ga('send','pageview');</script><meta name=google-site-verification content=Ie2d0Oy5dhnMbWcw7qg7PIeq3Wiv9X7GoyyL9pz39Eo></head><body><!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]--><nav class="navbar navbar-default navbar-top"><div class=container><!-- Brand and toggle get grouped for better mobile display --><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">Ryan Brooks</a></div><!-- Collect the nav links, forms, and other content for toggling --><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav"><li><a href=/archives.html>Blog archive</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a class="nav-fa-link target=" _blank="" href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></li></ul></div><!-- /.navbar-collapse --></div></nav><div class=container><div class=row><div class=col-sm-9><h1 class=page-title>Setting up Grails code quality tools with local Sonar</h1><span class=text-muted>21 Nov 2013</span><p></p><p>We want to be able to measure code quality for a Grails/Javascript project I‚Äôve just joined. I have had good experiences with Sonar before, so set out to get the important (to me) metrics from one into the other:</p><ul><li>Code coverage</li><li>Complexity</li><li>Duplicated code</li><li>Code violations (poor coding constructs)</li></ul><p>Despite a load of Google results suggesting it would be impossible (or at least quite hard), it turned out to be relatively straightforward.</p><!-- more --><h2 id=setting-up-sonar>Setting up Sonar</h2><p>Install sonar using brew: <code>bash brew install sonar sonar-runner</code></p><p>To have launchd start sonar at login: <code>bash ln -sfv /opt/boxen/homebrew/opt/sonar/*.plist ~/Library/LaunchAgents</code></p><p>Then to load sonar now: <code>bash launchctl load ~/Library/LaunchAgents/homebrew.mxcl.sonar.plist</code></p><p>You can check it‚Äôs running at http://localhost:9000/, but you can use nginx to give you a prettier URL (I‚Äôll cover that in a later post). While you‚Äôre at it <strong>change the default ‚Äúadmin‚Äù user password from ‚Äúadmin‚Äù</strong>.</p><h2 id=adding-maven-to-the-grails-project-to-run-sonar>Adding Maven to the Grails project to run Sonar</h2><p>We need to set up Maven to post the results to Sonar. Because we don‚Äôt want local machine configuration included in the project Git repository, let‚Äôs add the database connection details to our local Maven settings file (~/.m2/settings.xml) which may not exist yet, so just create it with the following contents:</p><noscript><pre>&lt;settings&gt;
    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;sonar&lt;/id&gt;
            &lt;activation&gt;
                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
            &lt;/activation&gt;
            &lt;properties&gt;
                &lt;!-- Example for MySQL--&gt;
                &lt;sonar.jdbc.url&gt;
                  jdbc:mysql://localhost:3306/sonar?useUnicode=true&amp;amp;characterEncoding=utf8
                &lt;/sonar.jdbc.url&gt;
                &lt;sonar.jdbc.username&gt;sonar&lt;/sonar.jdbc.username&gt;
                &lt;sonar.jdbc.password&gt;sonar&lt;/sonar.jdbc.password&gt;
 
                &lt;!-- Optional URL to server. Default value is http://localhost:9000 --&gt;
                &lt;sonar.host.url&gt;
                  http://sonar.dev
                &lt;/sonar.host.url&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
     &lt;/profiles&gt;
&lt;/settings&gt;</pre></noscript><script src=https://gist.github.com/spikeheap/7563286.js></script><p>The important elements to check are:</p><ul><li>sonar.host.url, which should be ‚Äúhttp://localhost:9000‚Äù unless you‚Äôre proxying through nginx</li><li>sonar.jdbc.url and ensure that database actually exists (I use postgres, pick your own flavour)</li><li>sonar.jdbc.username</li><li>sonar.jdbc.password</li></ul><p>You then need to add a pom.xml file to the project you want to analyse:</p><noscript><pre>&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
	&lt;groupId&gt;com.company.yourproject&lt;/groupId&gt;
	&lt;artifactId&gt;YOURPROJECT&lt;/artifactId&gt;
	&lt;version&gt;1.0&lt;/version&gt;
	&lt;packaging&gt;pom&lt;/packaging&gt;
	&lt;name&gt;YOUR PROJECT&lt;/name&gt;
	&lt;build&gt;
		&lt;sourceDirectory&gt;grails-app&lt;/sourceDirectory&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
				&lt;configuration&gt;
					&lt;source&gt;1.6&lt;/source&gt;
					&lt;target&gt;1.6&lt;/target&gt;
					&lt;excludes&gt;
						&lt;exclude&gt;**/*.*&lt;/exclude&gt;
					&lt;/excludes&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
				&lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;1.1&lt;/version&gt;
				&lt;executions&gt;
					&lt;execution&gt;
						&lt;id&gt;add-source&lt;/id&gt;
						&lt;phase&gt;generate-sources&lt;/phase&gt;
						&lt;goals&gt;
							&lt;goal&gt;add-source&lt;/goal&gt;
						&lt;/goals&gt;
						&lt;configuration&gt;
							&lt;sources&gt;
								&lt;source&gt;src&lt;/source&gt;
								&lt;source&gt;grails-app&lt;/source&gt;
							&lt;/sources&gt;
						&lt;/configuration&gt;
					&lt;/execution&gt;
				&lt;/executions&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
	&lt;properties&gt;
		&lt;sonar.language&gt;grvy&lt;/sonar.language&gt;
		&lt;sonar.dynamicAnalysis&gt;reuseReports&lt;/sonar.dynamicAnalysis&gt;
		&lt;sonar.surefire.reportsPath&gt;test/reports&lt;/sonar.surefire.reportsPath&gt;
		&lt;sonar.cobertura.reportPath&gt;test/reports/cobertura/coverage.xml&lt;/sonar.cobertura.reportPath&gt;
		&lt;sonar.phase&gt;generate-sources&lt;/sonar.phase&gt;
	&lt;/properties&gt;
&lt;/project&gt;
</pre></noscript><script src=https://gist.github.com/spikeheap/7564644.js></script><p>Here the points of interest are:</p><ul><li>groupId</li><li>artifactId</li><li>name</li><li>sources, ensuring all your source code is under inspection</li></ul><p>You can test for success by running ‚Äúmvn sonar:sonar -DskipTests=true‚Äù in the same directory as the pom.xml file. All things being equal it will show ‚ÄúBuild Success‚Äù on the command line and populate your Sonar installation with a project.</p><p>Note that this only does analysis of the Groovy files, and analyses the Java source using the Groovy rules. Newer versions of Sonar support multi-language projects, but in a fairly awkward way. Perhaps over the weekend I‚Äôll get a chance to include some Javascript code quality too.</p><p>When I next get a few minutes I‚Äôm going to get this set up in Jenkins and tie it all together with nginx, and possibly write about how we‚Äôre automating it all with Boxen. Until the next time‚Ä¶</p><hr><p>Was this post useful? Why not help others find it by sharing on <a href="https://twitter.com/intent/user?screen_name=spikeheap" target=_blank><i class="fa fa-twitter"></i> twitter</a>. While you're there, get in touch and let me know what you think!</p><div class=post-nav><a class="hidden-xs btn btn-sm btn-default pull-left half-width-max text-overflow" href="/posts/2013-11-20-automating-central-heating-control-with-a-raspberry-pi/"><i class="fa fa-arrow-circle-left"></i> Plans for automating central heating control with a Raspberry Pi</a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2013-11-20-automating-central-heating-control-with-a-raspberry-pi/"><i class="fa fa-fw fa-arrow-circle-left"></i> Plans for automating central heating control with a Raspberry Pi</a> <a class="btn btn-sm btn-default hidden-xs pull-right half-width-max text-overflow" href="/posts/2013-11-21-cycle-commuting-the-good-the-bad-and-the-ugly/">Cycle commuting: the good, the bad and the ugly <i class="fa fa-arrow-circle-right"></i></a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2013-11-21-cycle-commuting-the-good-the-bad-and-the-ugly/"><i class="fa fa-fw fa-arrow-circle-right"></i> Cycle commuting: the good, the bad and the ugly</a> <span class=clearfix></span></div><div id=disqus_thread></div><!-- Disqus comments --><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ryanbrooks'; // required: replace example with your forum shortname
    var disqus_identifier = 'posts-2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar';
    var disqus_title = 'Setting up Grails code quality tools with local Sonar';
    var disqus_url = 'https://www.ryanbrooks.co.uk/posts/2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class="col-sm-3 border-left"><div class=bio><img src=/images/profile-400px.7d5e.jpg><h3>Hi, I'm Ryan</h3><p>I care about code, building great teams and the community. I run <a href=https://www.slatehorse.com>Slate Horse</a> but I'm still a full-stack developer, and co-organiser of <a href="http://jsoxford.com/">JSOxford</a> and <a href="http://oxrug.org/">OxRUG</a>.</p><hr><h4>Get in touch</h4><div class=contact-icons><a target=_blank href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a> <a target=_blank href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a> <a target=_blank href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a> <a target=_blank href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></div></div></div></div></div><footer class="container-fluid footer--bottom"><div class=container><small>&copy; Ryan Brooks. The content of this page is licensed under the Creative Commons Attribution 3.0 License.</small></div></footer><script src=/bower_components/jquery/dist/jquery.min.js></script><script src=/bower_components/bootstrap-sass/assets/javascripts/bootstrap.js></script></body></html>