<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title></title><meta name=description content=""><meta name=viewport content="width=device-width, initial-scale=1"><link rel=alternate type=application/rss+xml title="Ryan Brooks' blog" href=http://ryanbrooks.co.uk/feed.xml><link rel=stylesheet href=/css/style.b43e.css><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-43110335-1');ga('send','pageview');</script></head><body><!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]--><nav class="navbar navbar-default navbar-top"><div class=container><!-- Brand and toggle get grouped for better mobile display --><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">Ryan Brooks</a></div><!-- Collect the nav links, forms, and other content for toggling --><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav"><li><a href=/archives.html>Blog archive</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a target=_blank href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a></li><li><a target=_blank href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a></li><li><a target=_blank href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a></li><li><a target=_blank href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></li></ul></div><!-- /.navbar-collapse --></div></nav><!-- <div id="header" class="jumbotron">
	<div class="container">
		<h1><a href="/">Ryan Brooks' blog</a></h1>
	</div>
</div> --><div class=container><div class=row><div class=col-xs-12><a href="/posts/2013-11-20-automating-central-heating-control-with-a-raspberry-pi/"><i class="fa fa-arrow-circle-left"></i> prev</a> | <a href="/posts/2013-11-21-cycle-commuting-the-good-the-bad-and-the-ugly/">next <i class="fa fa-arrow-circle-right"></i></a><h1>Setting up Grails code quality tools with local Sonar <small>21 Nov 2013</small></h1><p></p><p>We want to be able to measure code quality for a Grails/Javascript project I’ve just joined. I have had good experiences with Sonar before, so set out to get the important (to me) metrics from one into the other:</p><ul><li>Code coverage</li><li>Complexity</li><li>Duplicated code</li><li>Code violations (poor coding constructs)</li></ul><p>Despite a load of Google results suggesting it would be impossible (or at least quite hard), it turned out to be relatively straightforward.</p><!-- more --><h2 id=setting-up-sonar>Setting up Sonar</h2><p>Install sonar using brew:<br><code>bash brew install sonar sonar-runner</code></p><p>To have launchd start sonar at login:<br><code>bash ln -sfv /opt/boxen/homebrew/opt/sonar/*.plist ~/Library/LaunchAgents</code></p><p>Then to load sonar now:<br><code>bash launchctl load ~/Library/LaunchAgents/homebrew.mxcl.sonar.plist</code></p><p>You can check it’s running at http://localhost:9000/, but you can use nginx to give you a prettier URL (I’ll cover that in a later post). While you’re at it <strong>change the default “admin” user password from “admin”</strong>.</p><h2 id=adding-maven-to-the-grails-project-to-run-sonar>Adding Maven to the Grails project to run Sonar</h2><p>We need to set up Maven to post the results to Sonar. Because we don’t want local machine configuration included in the project Git repository, let’s add the database connection details to our local Maven settings file (~/.m2/settings.xml) which may not exist yet, so just create it with the following contents:</p><script src=https://gist.github.com/spikeheap/7563286.js></script><p>The important elements to check are:</p><ul><li>sonar.host.url, which should be “http://localhost:9000” unless you’re proxying through nginx</li><li>sonar.jdbc.url and ensure that database actually exists (I use postgres, pick your own flavour)</li><li>sonar.jdbc.username</li><li>sonar.jdbc.password</li></ul><p>You then need to add a pom.xml file to the project you want to analyse:</p><script src=https://gist.github.com/spikeheap/7564644.js></script><p>Here the points of interest are:</p><ul><li>groupId</li><li>artifactId</li><li>name</li><li>sources, ensuring all your source code is under inspection</li></ul><p>You can test for success by running “mvn sonar:sonar -DskipTests=true” in the same directory as the pom.xml file. All things being equal it will show “Build Success” on the command line and populate your Sonar installation with a project.</p><p>Note that this only does analysis of the Groovy files, and analyses the Java source using the Groovy rules. Newer versions of Sonar support multi-language projects, but in a fairly awkward way. Perhaps over the weekend I’ll get a chance to include some Javascript code quality too.</p><p>When I next get a few minutes I’m going to get this set up in Jenkins and tie it all together with nginx, and possibly write about how we’re automating it all with Boxen. Until the next time…</p><div><a class=twitter-share-button href=https://twitter.com/share data-url="http://ryanbrooks.co.uk/posts/2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar/" data-via=spikeheap>Tweet</a> <a class=twitter-follow-button href=https://twitter.com/spikeheap data-show-count=false data-lang=en>Follow @spikeheap</a> <!-- set data-annotation to 'bubble' for count --><div class=g-plus data-action=share data-annotation=none></div></div><a href="/posts/2013-11-20-automating-central-heating-control-with-a-raspberry-pi/"><i class="fa fa-arrow-circle-left"></i> prev</a> | <a href="/posts/2013-11-21-cycle-commuting-the-good-the-bad-and-the-ugly/">next <i class="fa fa-arrow-circle-right"></i></a><div id=disqus_thread></div><!-- Disqus comments --><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ryanbrooks'; // required: replace example with your forum shortname
    var disqus_identifier = 'posts-2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar';
    var disqus_title = 'Setting up Grails code quality tools with local Sonar';
    var disqus_url = 'http://ryanbrooks.co.uk/posts/2013-11-21-setting-up-grails-code-quality-tools-with-local-sonar/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href="/posts/2013-11-20-automating-central-heating-control-with-a-raspberry-pi/"><i class="fa fa-arrow-circle-left"></i> prev</a> | <a href="/posts/2013-11-21-cycle-commuting-the-good-the-bad-and-the-ugly/">next <i class="fa fa-arrow-circle-right"></i></a></div></div></div><footer id=footer class=container-fluid><div class=footer--top><div class=row><div class="col-xs-5 col-sm-4 col-md-3 col-lg-2"><h1>Get in touch</h1><div class=contact-icons><a target=_blank href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a> <a target=_blank href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a> <a target=_blank href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a> <a target=_blank href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></div></div><div class="col-xs-7 col-sm-6 col-md-5 col-lg-4"><h1>Hi, I'm Ryan</h1><p>I care about code, process and the community. I'm a freelance CTO and full-stack developer, and co-organiser of <a href="http://jsoxford.com/">JSOxford</a>.</p></div></div></div></footer><!-- <footer class="container-fluid footer--middle">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<h1>Have a look around
    				<span>Home</span>
    				<span>Blog</span>
    				<span>More about me</span>
    				</h1>
			</div>
		</div>
	</div>		
</footer> --><footer class="container-fluid footer--bottom"><div class=container><small>&copy; Ryan Brooks. The content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the Apache 2.</small></div></footer><script src=/bower_components/jquery/dist/jquery.min.js></script><script src=/bower_components/bootstrap-sass/assets/javascripts/bootstrap.js></script><!-- Twitter bits --><script>window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));</script><!-- Google plus --><script src=https://apis.google.com/js/platform.js async defer>{lang: 'en-GB'}</script></body></html>