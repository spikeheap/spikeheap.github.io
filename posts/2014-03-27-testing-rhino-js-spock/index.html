<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title></title><meta name=description content=""><meta name=viewport content="width=device-width, initial-scale=1"><link rel=alternate type=application/rss+xml title="Ryan Brooks' blog" href=http://ryanbrooks.co.uk/feed.xml><link rel=stylesheet href=/css/style.8359.css><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-43110335-1');ga('send','pageview');</script><meta name=google-site-verification content=Ie2d0Oy5dhnMbWcw7qg7PIeq3Wiv9X7GoyyL9pz39Eo></head><body><!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]--><nav class="navbar navbar-default navbar-top"><div class=container><!-- Brand and toggle get grouped for better mobile display --><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">Ryan Brooks</a></div><!-- Collect the nav links, forms, and other content for toggling --><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav"><li><a href=/archives.html>Blog archive</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a class="nav-fa-link target=" _blank="" href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></li></ul></div><!-- /.navbar-collapse --></div></nav><div class=container><div class=row><div class=col-xs-9><h1>Testing Rhino JavaScript with Eclipse, Gradle, Groovy and Spock</h1><span class=text-muted>27 Mar 2014</span><p></p><p>A colleague was wrangling with JavaScript testing, but with an unusual constraint: the code runs on the <a href=https://developer.mozilla.org/en-US/docs/Rhino>Rhino JS engine</a>. After a bit of head-banging, I learned that continuously testing JavaScript written for Rhino needn’t be arduous.</p><!-- more --><h2 id=other-potential-solutions>Other potential solutions</h2><p>There are a number of ways of tackling this problem. Initially we attempted to use one of the many existing JavaScript testing libraries, running on Rhino. Jasmine running on Karma was my first choice, but we soon hit issues with <code>require</code> not being present. Since giving up on that avenue I’ve discovered <a href=http://www.angrycoding.com/2011/09/mozilla-rhino-commonjs-module-support.html>CommonJS for Rhino</a>. That solution may be preferable because it allows you to write your tests in JavaScript, but I love Spock’s data driven capabilities and the cleanness of spec tests, so I’m not disappointed with our result.</p><h2 id=configuring-gradle>Configuring Gradle</h2><p>We need Gradle to download our dependencies and run the tests, so the first thing to do is initialise a Gradle project:</p><pre><code class=language-bash>gradle init
</code></pre><p>And then edit the <code>build.gradle</code> file to look something like the following:</p><script src="https://gist.github.com/spikeheap/9808514.js?file=build.gradle"></script><p>This will ensure we’ve got Rhino on our classpath, and can use Spock to write our tests. The last <code>compile</code> dependency allows us to include JAR files in a <code>lib</code> directory, which can be handy if you use libraries not available through Bintray or Maven.</p><p>We’ll use the standard Maven source locations, which we need to create manually:</p><pre><code class=language-bash>mkdir -p src/{main,test}/{groovy,js}
</code></pre><p>We’ve now got a Gradle project which we can test with <code>gradle check</code>, although there’s not much to see at the moment.</p><h2 id=eclipse>Eclipse</h2><p>There are a couple of plugins we need for Eclipse</p><ul><li>The <a href=http://groovy.codehaus.org/Eclipse+Plugin>Groovy-Eclipse plugin</a> (requires the http://dist.springsource.org/release/GRECLIPSE/e4.3/ update site).</li><li>The <a href="https://github.com/spring-projects/eclipse-integration-gradle/">Gradle IDE plugin</a> (requires the http://dist.springsource.com/release/TOOLS/gradle update site).</li></ul><p>Once they’re installed run <code>gradle eclipse</code> in the terminal to generate the Eclipse settings files, and then import it into Eclipse with <code>File &gt; Import... &gt; General &gt; Existing Projects into Workspace</code>.</p><h3 id=running-tests>Running tests</h3><p>In the <code>Run &gt; Run Configurations</code> configuration, add a JUnit run configuration set to Run all tests in the selected project, package or source folder (selecting the root of tests).</p><p>You can now run the tests (even Spock tests) just like normal!</p><h1 id=testable-javascript>Testable JavaScript</h1><p>We’ll create a sample JavaScript file to test in <code>src/main/js/littleFunction.js</code>, containing the following:</p><script src="https://gist.github.com/spikeheap/9808514.js?file=littleFunction.js"></script><p>That code isn’t likely to win any awards, but we can check that it works by writing a specification.</p><h2 id=writing-tests>Writing tests</h2><p>Create a Groovy class named <code>LittleFunctionSpec.groovy</code> in <code>src/test/groovy/my/package/</code>, containing the following:</p><script src="https://gist.github.com/spikeheap/9808514.js?file=LittleFunctionSpec.groovy"></script><p>This gives us our Rhino environment (context). Note that if you want to use <code>XML</code> objects you’ll need to use a context version &gt; 1.7. All we need to do now is add a test:</p><script src="https://gist.github.com/spikeheap/9808514.js?file=LittleFunctionSpecPartial1.groovy"></script><p>Hopefully that specification is pretty self-explanatory. For more information <a href="http://spock-framework.readthedocs.org/en/latest/">Check out the Spock documentation</a>.</p><p>The example above used a single value, but we probably want to check quite a few. Spock’s <a href=http://spock-framework.readthedocs.org/en/latest/data_driven_testing.html>Data Driven Testing support</a> makes this simple, so we can rewrite the test as:</p><script src="https://gist.github.com/spikeheap/9808514.js?file=LittleFunctionSpecPartial2.groovy"></script><h2 id=running-tests-1>Running tests</h2><p>Running the tests is as easy as <code>gradle check</code>, or pushing the <code>run</code> button in Eclipse. Doing the former, your test results will be output into an easy-to-read HTML file as well as JUnit XML.</p><h1 id=conclusion>Conclusion</h1><p>Using a few simple steps we’ve set up a Gradle project to run Spock tests over Rhino JavaScript, with the added bonus of being able to use Eclipse.</p><p>Because we can now run tests with a single command and interpret the result with most tools (either through the Gradle exit code or the JUnit output), adding this to a continuous build system like <a href=http://travis-ci.org>Travis</a> or <a href="http://jenkins-ci.org/">Jenkins</a> is simple!</p><hr><p>Was this post useful? Why not help others find it by sharing on <a href="https://twitter.com/intent/user?screen_name=spikeheap" target=_blank><i class="fa fa-twitter"></i> twitter</a>. While you're there, get in touch and let me know what you think!</p><div class=post-nav><a class="hidden-xs btn btn-sm btn-default pull-left half-width-max text-overflow" href="/posts/2014-02-27-docpad-disqus-comments/"><i class="fa fa-arrow-circle-left"></i> Disqus comment threads on a docpad homepage</a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2014-02-27-docpad-disqus-comments/"><i class="fa fa-fw fa-arrow-circle-left"></i> Disqus comment threads on a docpad homepage</a> <a class="btn btn-sm btn-default hidden-xs pull-right half-width-max text-overflow" href="/posts/2014-08-06-code-retreat-thoughts/">Oxford's Summer of Hacks 2014 – Code Retreat <i class="fa fa-arrow-circle-right"></i></a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2014-08-06-code-retreat-thoughts/"><i class="fa fa-fw fa-arrow-circle-right"></i> Oxford's Summer of Hacks 2014 – Code Retreat</a> <span class=clearfix></span></div><div id=disqus_thread></div><!-- Disqus comments --><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ryanbrooks'; // required: replace example with your forum shortname
    var disqus_identifier = 'posts-2014-03-27-testing-rhino-js-spock';
    var disqus_title = 'Testing Rhino JavaScript with Eclipse, Gradle, Groovy and Spock';
    var disqus_url = 'http://ryanbrooks.co.uk/posts/2014-03-27-testing-rhino-js-spock/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=col-xs-3><div class=bio><img class=img-circle src=/images/profile-400px.7699.jpg><h3>Hi, I'm Ryan</h3><p>I care about code, building great teams and the community. I'm a freelance CTO and full-stack developer, and co-organiser of <a href="http://jsoxford.com/">JSOxford</a> and <a href="http://oxrug.org/">OxRUG</a>.</p><hr><h4>Get in touch</h4><div class=contact-icons><a target=_blank href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a> <a target=_blank href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a> <a target=_blank href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a> <a target=_blank href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></div></div></div></div></div><footer class="container-fluid footer--bottom"><div class=container><small>&copy; Ryan Brooks. The content of this page is licensed under the Creative Commons Attribution 3.0 License.</small></div></footer><script src=/bower_components/jquery/dist/jquery.min.js></script><script src=/bower_components/bootstrap-sass/assets/javascripts/bootstrap.js></script></body></html>