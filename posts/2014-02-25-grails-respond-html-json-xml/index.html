<!DOCTYPE html><!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html class=no-js><!--<![endif]--><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title></title><meta name=description content=""><meta name=viewport content="width=device-width, initial-scale=1"><link rel=alternate type=application/rss+xml title="Ryan Brooks' blog" href=http://ryanbrooks.co.uk/feed.xml><link rel=stylesheet href=/css/style.db18.css><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-43110335-1');ga('send','pageview');</script><meta name=google-site-verification content=Ie2d0Oy5dhnMbWcw7qg7PIeq3Wiv9X7GoyyL9pz39Eo></head><body><!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]--><nav class="navbar navbar-default navbar-top"><div class=container><!-- Brand and toggle get grouped for better mobile display --><div class=navbar-header><button type=button class="navbar-toggle collapsed" data-toggle=collapse data-target=#bs-example-navbar-collapse-1><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href="/">Ryan Brooks</a></div><!-- Collect the nav links, forms, and other content for toggling --><div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1><ul class="nav navbar-nav"><li><a href=/archives.html>Blog archive</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a class="nav-fa-link target=" _blank="" href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a></li><li><a class="nav-fa-link target=" _blank="" href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></li></ul></div><!-- /.navbar-collapse --></div></nav><div class=container><div class=row><div class=col-sm-9><h1 class=page-title>Using Grails respond for HTML, JSON and XML responses</h1><span class=text-muted>25 Feb 2014</span><p></p><p>The new(ish) support for <code>respond</code> in Grails 2.3 is great, and saves us the hassle of specifying different render/response calls depending on the content type. Surpisingly it falters when it comes to returning exceptions and errors, for example <code>404 NOT FOUND</code>. This post describes a simple workaround which provides a meaningful response to a JSON/XML request as well as a user-friendly rendered 404 exception for humans.</p><!-- more --><p>The obvious approach is to respond with the object:</p><p>true<script src="https://gist.github.com/spikeheap/9213738.js?file=1_obvious_approach.groovy"></script></p><p>The above works great for basic JSON/XML requests, as it returns a 404 status code and no content. The main problem is that it doesn’t render HTML responses, so a user is presented with a blank page. Not so nice.</p><p>The following will quite happily respond with the correct content type for a valid widget, but if the widget doesn’t exist a 404 HTML page and 404 status code are returned (even if you requested JSON/XML):</p><p>true<script src="https://gist.github.com/spikeheap/9213738.js?file=2_html_only.groovy"></script></p><p>We’re almost there, but not quite. We can use the <code>respond</code> method and manually pass back the HTTP status and the view:</p><p>true<script src="https://gist.github.com/spikeheap/9213738.js?file=3_working_html_json_xml.groovy"></script></p><p>Hey presto, 404 error pages for HTML users, and a blank 404 response for JSON/XML requests. Obviously the above assumes you have a view named <code>error404.gsp</code> to display a pretty 404 error page.</p><p>It might be a bit nicer if our JSON and XML responses contained a similar amount of information, and if we could pass some contextual information to the view (for example the type of thing we couldn’t find). No problem, just define a map with our response objects and then define that same map as the view model, along with the status code and view:</p><p>true<script src="https://gist.github.com/spikeheap/9213738.js?file=4_the_full_sausage.groovy"></script></p><p>Let’s break the 404 response down a little.</p><ol><li><code>if(!widget)</code> is a Groovy way of checking for null/empty values</li><li>The model we’re going to return has an obvious failure notification because we’ve set <code>success</code> to <code>false</code>, but we’ve added a little more information by saying the widget couldn’t be found.</li><li>The first argument to <code>respond</code> is <code>model as Object</code>. This tells <code>respond</code> to use <code>model</code> for the JSON and XML responses. The coercion is required to prevent an error because of ambiguous arguments.</li><li>The second argument to <code>respond</code> is <code>[model: model, status: 404, view: 'error404']</code>, which provides the view arguments so the correct 404 GSP is loaded. The <code>model</code> specified here is the same as is used for the JSON/XML response, so the GSP has access to the same information to render to the user.</li></ol><hr><p>So there we have it: a simple way to <code>respond</code> and please all our sources. It’s not quite elegant, and I’m going to see how easy it would be to roll this into the <code>respond</code> method itself.</p><p>Is there a better way? Let me know in the comments!</p><hr><p>Was this post useful? Why not help others find it by sharing on <a href="https://twitter.com/intent/user?screen_name=spikeheap" target=_blank><i class="fa fa-twitter"></i> twitter</a>. While you're there, get in touch and let me know what you think!</p><div class=post-nav><a class="hidden-xs btn btn-sm btn-default pull-left half-width-max text-overflow" href="/posts/2014-02-24-cycle-safely-please-oxford/"><i class="fa fa-arrow-circle-left"></i> Cycle safely please Oxford</a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2014-02-24-cycle-safely-please-oxford/"><i class="fa fa-fw fa-arrow-circle-left"></i> Cycle safely please Oxford</a> <a class="btn btn-sm btn-default hidden-xs pull-right half-width-max text-overflow" href="/posts/2014-02-27-docpad-disqus-comments/">Disqus comment threads on a docpad homepage <i class="fa fa-arrow-circle-right"></i></a> <a class="visible-xs-block btn btn-default btn-block text-overflow" href="/posts/2014-02-27-docpad-disqus-comments/"><i class="fa fa-fw fa-arrow-circle-right"></i> Disqus comment threads on a docpad homepage</a> <span class=clearfix></span></div><div id=disqus_thread></div><!-- Disqus comments --><script type=text/javascript>/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ryanbrooks'; // required: replace example with your forum shortname
    var disqus_identifier = 'posts-2014-02-25-grails-respond-html-json-xml';
    var disqus_title = 'Using Grails respond for HTML, JSON and XML responses';
    var disqus_url = 'http://ryanbrooks.co.uk/posts/2014-02-25-grails-respond-html-json-xml/';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class="col-sm-3 border-left"><div class=bio><img src=/images/profile-400px.7d5e.jpg><h3>Hi, I'm Ryan</h3><p>I care about code, building great teams and the community. I'm a freelance CTO and full-stack developer, and co-organiser of <a href="http://jsoxford.com/">JSOxford</a> and <a href="http://oxrug.org/">OxRUG</a>.</p><hr><h4>Get in touch</h4><div class=contact-icons><a target=_blank href=https://twitter.com/spikeheap><i class="fa fa-2x fa-twitter-square"></i></a> <a target=_blank href=https://github.com/spikeheap><i class="fa fa-2x fa-github-square"></i></a> <a target=_blank href=http://uk.linkedin.com/in/ryanpbrooks><i class="fa fa-2x fa-linkedin-square"></i></a> <a target=_blank href=mailto:ryanbrooksis+info@gmail.com><i class="fa fa-2x fa-envelope-square"></i></a></div></div></div></div></div><footer class="container-fluid footer--bottom"><div class=container><small>&copy; Ryan Brooks. The content of this page is licensed under the Creative Commons Attribution 3.0 License.</small></div></footer><script src=/bower_components/jquery/dist/jquery.min.js></script><script src=/bower_components/bootstrap-sass/assets/javascripts/bootstrap.js></script></body></html>