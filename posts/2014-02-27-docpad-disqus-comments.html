<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.26.2 by Michael Rose
  Copyright 2013-2024 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en-GB" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Disqus comment threads on a docpad homepage - Ryan Brooks’ blog</title>
<meta name="description" content="I really do get on well with docpad. Adding comments to the homepage blog entry was a little tricky though, so here’s the workaround I applied.">


  <meta name="author" content="Ryan Brooks">
  
  <meta property="article:author" content="Ryan Brooks">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Ryan Brooks' blog">
<meta property="og:title" content="Disqus comment threads on a docpad homepage">
<meta property="og:url" content="https://www.ryanbrooks.co.uk/posts/2014-02-27-docpad-disqus-comments.html">


  <meta property="og:description" content="I really do get on well with docpad. Adding comments to the homepage blog entry was a little tricky though, so here’s the workaround I applied.">







  <meta property="article:published_time" content="2014-02-27T18:58:00+00:00">






<link rel="canonical" href="https://www.ryanbrooks.co.uk/posts/2014-02-27-docpad-disqus-comments.html">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ryan Brooks' blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script type="text/javascript">
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Ryan Brooks' blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a
                href="/prev"
                
                
              >Previously</a>
            </li><li class="masthead__menu-item">
              <a
                href="/now"
                
                
              >Now</a>
            </li><li class="masthead__menu-item">
              <a
                href="/posts-by-year/"
                
                
              >Posts</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="https://www.ryanbrooks.co.uk/">
        <img src="/images/ryan_brooks_peak_autumn_2020.jpg" alt="Ryan Brooks" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="https://www.ryanbrooks.co.uk/" itemprop="url">Ryan Brooks</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>CTO with a dev &amp; ops origin story. Camembert lover/buzzword hater. Ex JSOxford, OxRUG, MoJ, GDS. Only personal opinions here</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Sheffield, UK</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://ruby.social/@spikeheap" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i><span class="label">Mastodon</span></a></li>
          
        
          
            <li><a href="https://github.com/spikeheap" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Disqus comment threads on a docpad homepage">
    <meta itemprop="description" content="I really do get on well with docpad. Adding comments to the homepage blog entry was a little tricky though, so here’s the workaround I applied.">
    <meta itemprop="datePublished" content="2014-02-27T18:58:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="https://www.ryanbrooks.co.uk/posts/2014-02-27-docpad-disqus-comments.html" itemprop="url">Disqus comment threads on a docpad homepage
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>I really do get on well with <a href="http://docpad.org/">docpad</a>. Adding comments to the homepage blog entry was a little tricky though, so here’s the workaround I applied.</p>

<p>Despite wanting to move to a JVM-based static site generator, docpad does too many things to make me want to leave. It’s not perfect, but it has plugins to solve mosts of your basic problems, and is nicely hackable. Plus it’s written in CoffeScript, which is always a plus.  The <a href="https://github.com/docpad/docpad-plugin-services">services plugin</a> provides a neat way to inject Disqus comment threads into your pages. It’s almost zero configuration and works reliably, but it doesn’t work when you’re rendering dynamic content, for example the latest blog post on your home page.</p>

<p>Everything worked well until Disqus got confused. First it displayed the comments from a blog post on the homepage when it was no longer correct. Then it just started displaying the comment thread on all pages which didn’t have their own threads already. Not so good.</p>

<p>Fortunately Disqus support were very responsive, and got back to me explaining the problem: the Disqus widget doesn’t just need the title, it also needs a unique URL in its config. The services plugin doesn’t work for this, as it always gets the current page URL, so here’s a modified version of <a href="https://github.com/docpad/docpad-plugin-services/blob/master/src/services.plugin.coffee#L356">the original script</a> which takes a post as a parameter so you can load dynamic comment threads wherever you like.</p>

<p>All you need to do is add the following to your <code class="language-plaintext highlighter-rouge">docpad.cofee</code>, I put it in the helpers section:</p>

<div class="language-coffee highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">getPostDisqus</span><span class="o">:</span> <span class="p">(</span><span class="nx">post</span><span class="p">,</span> <span class="nx">services</span><span class="p">)</span> <span class="o">-&gt;</span>
	<span class="c1"># Prepare</span>
	<span class="nx">services</span> <span class="o">?=</span> <span class="vi">@</span><span class="na">getServices</span><span class="p">()</span>
	<span class="nx">disqusShortname</span> <span class="o">=</span> <span class="nx">services</span><span class="p">.</span><span class="na">disqus</span>
	<span class="k">return</span> <span class="s">''</span>  <span class="nx">unless</span> <span class="nx">disqusShortname</span>
	<span class="nx">disqusDeveloper</span> <span class="o">=</span> <span class="k">if</span> <span class="s">'production'</span> <span class="o">in</span> <span class="vi">@</span><span class="na">getEnvironments</span><span class="p">()</span> <span class="k">then</span> <span class="s">'0'</span> <span class="k">else</span> <span class="s">'1'</span>
	<span class="nx">pageUrl</span> <span class="o">=</span> <span class="p">(</span><span class="vi">@</span><span class="na">site</span><span class="p">.</span><span class="na">url</span> <span class="o">or</span> <span class="s">''</span><span class="p">)</span><span class="o">+</span><span class="nx">post</span><span class="p">.</span><span class="na">url</span>
	<span class="nx">disqusIdentifier</span> <span class="o">=</span> <span class="nx">post</span><span class="p">.</span><span class="na">slug</span>
	<span class="nx">disqusTitle</span> <span class="o">=</span> <span class="nx">post</span><span class="p">.</span><span class="na">title</span> <span class="o">or</span> <span class="nx">post</span><span class="p">.</span><span class="na">name</span>

	<span class="c1"># Return</span>
	<span class="k">return</span> <span class="s">"""
		&lt;div id="disqus_thread"&gt;&lt;/div&gt;
		&lt;script&gt;
			(function(){
				window.disqus_shortname = '</span><span class="si">#{</span><span class="nx">disqusShortname</span><span class="si">}</span><span class="s">';
				window.disqus_developer = '</span><span class="si">#{</span><span class="nx">disqusDeveloper</span><span class="si">}</span><span class="s">';
				window.disqus_url = '</span><span class="si">#{</span><span class="nx">pageUrl</span><span class="si">}</span><span class="s">';
				window.disqus_identifier = '</span><span class="si">#{</span><span class="nx">disqusIdentifier</span><span class="si">}</span><span class="s">';
				window.disqus_title = '</span><span class="si">#{</span><span class="nx">disqusTitle</span><span class="si">}</span><span class="s">';
				if ( window.DISQUS ) {
					return DISQUS.reset({
						reload: true,
						config: function () {
							this.page.identifier = window.disqus_identifier;
							this.page.url = window.disqus_url;
							this.page.title = window.disqus_title;
						}
					});
				}
				else {
				  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
				  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				}
			})();
		&lt;/script&gt;
		&lt;noscript&gt;Please enable JavaScript to view the &lt;a href="http://disqus.com/?ref_noscript"&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;
		&lt;a href="http://disqus.com" class="dsq-brlink"&gt;comments powered by &lt;span class="logo-disqus"&gt;Disqus&lt;/span&gt;&lt;/a&gt;
		"""</span>
</code></pre></div></div>

<p>Then you can add the comments to your index page, like so:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;</span><span class="err">%</span> <span class="na">latestPost = </span><span class="s">@getCollection('posts').toJSON()[0]</span> <span class="err">%</span><span class="nt">&gt;</span>

<span class="nt">&lt;article</span> <span class="na">id=</span><span class="s">"latestPost"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;h1&gt;&lt;a</span> <span class="na">href=</span><span class="s">"&lt;%= latestPost.url %&gt;"</span><span class="nt">&gt;&lt;</span><span class="err">%=</span> <span class="na">latestPost.title</span> <span class="err">%</span><span class="nt">&gt;&lt;/a&gt;&lt;/h1&gt;</span>
	<span class="nt">&lt;t</span> <span class="na">render=</span><span class="s">"markdown"</span><span class="nt">&gt;&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">latestPost.content</span> <span class="err">%</span><span class="nt">&gt;&lt;/t&gt;</span>

	<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
	<span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="err">@</span><span class="na">getPostDisqus</span><span class="err">(</span><span class="na">latestPost</span><span class="err">)</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/article&gt;</span>
</code></pre></div></div>

<p>I will submit this as a pull request just as soon as I figure out how to do it elegantly :), but this will do as a workaround for now.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#engineering" class="page__taxonomy-item p-category" rel="tag">engineering</a><span class="sep">, </span>
    
      <a href="/tags/#guide" class="page__taxonomy-item p-category" rel="tag">guide</a>
    
    </span>
  </p>




        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2014-02-27T18:58:00+00:00">February 27, 2014</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Disqus+comment+threads+on+a+docpad+homepage%20https%3A%2F%2Fwww.ryanbrooks.co.uk%2Fposts%2F2014-02-27-docpad-disqus-comments.html"
    class="btn btn--twitter"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on Twitter"><i
      class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.ryanbrooks.co.uk%2Fposts%2F2014-02-27-docpad-disqus-comments.html"
    class="btn btn--linkedin"
    onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
    title="Share on LinkedIn"><i
      class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      
  <nav class="pagination">
    
      <a href="/posts/2014-02-25-grails-respond-html-json-xml.html" class="pagination--pager" title="Using Grails respond for HTML, JSON and XML responses
">Previous</a>
    
    
      <a href="/posts/2014-03-27-testing-rhino-js-spock.html" class="pagination--pager" title="Testing Rhino JavaScript with Eclipse, Gradle, Groovy and Spock
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You May Also Enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/posts/2023-06-12-protect-yourself-first.html" rel="permalink">Protect yourself first
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">A common refrain in software engineering is to put your team before yourself. Also, put the customer first. Make sure you align with the organisation’s goals...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/posts/2023-02-17-linting-branch-changes.html" rel="permalink">Incrementally linting a codebase with branch changes
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Update 26th February 2023: replaced xargs approach because it interfered with Pry local debugging.

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/posts/2023-01-17-capybara-webmock-allow-http.html" rel="permalink">Capybara, WebMock, and too many open files
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Getting set up with a new codebase is always a fun, sometimes head-scratching experience where you have to discern whether the issues you’re facing are becau...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/posts/2023-01-16-docker-contexts.html" rel="permalink">Docker context switching
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Sometimes it’s useful to run multiple Docker contexts/daemons, e.g. if you’re running Docker Desktop and Lima, or local Kubernetes clusters.

</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://ruby.social/@spikeheap" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-mastodon" aria-hidden="true"></i> Mastodon</a></li>
        
      
        
          <li><a href="https://github.com/spikeheap" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 <a href="https://www.ryanbrooks.co.uk">Ryan Brooks' blog</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZVSM9FVFJ3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-ZVSM9FVFJ3', { 'anonymize_ip': true});
</script>








  </body>
</html>
